
ssh -i "/Users/thebigsun/Desktop/projects/social_media_project/social_media_project/backend/andrewkey.pem" ubuntu@ec2-107-21-150-23.compute-1.amazonaws.com





sudo apt-get update
sudo apt-get install -y docker.io docker-compose-plugin
sudo usermod -aG docker $USER
newgrp docker
docker --version && docker compose version
sudo apt-get update
sudo apt-get install -y docker.io docker-compose-plugin
sudo usermod -aG docker $USER
newgrp docker
docker --version && docker compose version


# on the server
sudo apt-get update && sudo apt-get install -y git

git config --global credential.helper store   # optional

git clone https://github.com/yongzhe-wang/social_media_project.git
# When prompted:
#   Username: <your GitHub username>
#   Password: <your Personal Access Token with repo scope>


cd social_media_project/backend

cp .env.example .env
docker compose up -d --build
docker compose ps




cd ~/social_media_project/backend
docker compose logs -f api



UPDATE FILES

cd ~/social_media_project
# keep your local .env safe just in case
cp backend/.env /tmp/backend.env || true

git fetch --all
git reset --hard origin/main    # force to remote main
# (if you changed branches, use the branch name you pushed instead)

# restore .env if needed
[ -f /tmp/backend.env ] && cp /tmp/backend.env backend/.env

cd ~/social_media_project/backend
docker compose down
docker compose up -d --build

cd ~/social_media_project/backend

# 1) Add the missing dep (one-liner append)
echo "python-multipart==0.0.9" | tee -a requirements.txt

# 2) Rebuild the API image and restart
docker compose build --no-cache api
docker compose up -d api

# 3) Watch logs until you see Uvicorn running
docker compose logs -f api




SMOKE TEST

# from the EC2 box
curl http://127.0.0.1:8000/healthz

# public (from anywhere)
curl http://107-21-150-23.sslip.io/healthz


